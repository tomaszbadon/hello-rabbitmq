<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Task Executor</title>

    <script src="/webjars/jquery/3.1.1/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/1.0.2/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/2.3.3/stomp.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">


    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./reset.css">

</head>

<body>

    <div id="task-content" class="my-container">
        <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0"
                aria-valuemax="100"></div>
        </div>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0"
                aria-valuemax="100"></div>
        </div>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0"
                aria-valuemax="100"></div>
        </div>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0"
                aria-valuemax="100"></div>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            $('#task-content').empty();

            setInterval(function() { 

            $.ajax({
                url: "/tasks",
                context: document.body,
                dataType: 'json'
            }).done(function (data) {

                data.tasks.forEach(task => {
                    if( $($('#' + task.id)).length ) {
                        $('#' + task.id).css('width', task.progress+'%');
                    } else {
                        var div = '<div class="progress">' +
                            '<div id="' + task.id + '" class="progress-bar" role="progressbar" style="width: ' + task.progress + '%" aria-valuenow="100" aria-valuemin="0"' +
                            'aria-valuemax="100"></div>' +
                            '</div>';
                        $('#task-content').append(div);
                    }
                });

                readyForRefresh = true;
            });


            }, 5000);
/*
            var readyForRefresh = false;

            $.ajax({
                url: "/tasks",
                context: document.body,
                dataType: 'json'
            }).done(function (data) {

                $('#task-content').empty();

                data.tasks.forEach(task => {
                    var div = '<div class="progress">' +
                        '<div id="' + task.id + '" class="progress-bar" role="progressbar" style="width: ' + task.progress + '%" aria-valuenow="100" aria-valuemin="0"' +
                        'aria-valuemax="100"></div>' +
                        '</div>';
                    $('#task-content').append(div);
                });

                readyForRefresh = true;
            });


            setInterval(function () {

                $.ajax({
                    url: "/tasks",
                    context: document.body,
                    dataType: 'json'
                }).done(function (data) {

                    data.tasks.forEach(task => {
                        

                        $('#' + task.id).css('width', task.progress+'%');

                    });

                    readyForRefresh = true;
                });
            }, 5000);
*/



        });
    </script>




</body>

</html>